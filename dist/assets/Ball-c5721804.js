import{a as e,_ as t,u as o,m as n,j as r,C as s,b as i,O as a,P as l,c as u}from"./index-8e311368.js";import{B as c,V as p,H as f,aC as m,r as h,a7 as d,aD as x,J as y,ad as g,X as w,aE as b}from"./vendor-0ffcf883.js";class v extends c{constructor(e,t,o,n){super();const r=[],s=[],i=[],a=new p,l=new f;l.makeRotationFromEuler(o),l.setPosition(t);const u=new f;function c(t,o,n){o.applyMatrix4(e.matrixWorld),o.applyMatrix4(u),n.transformDirection(e.matrixWorld),t.push(new E(o.clone(),n.clone()))}function h(e,t){const o=[],r=.5*Math.abs(n.dot(t));for(let n=0;n<e.length;n+=3){let s,i,a,l,u,c,p,f=0;switch(s=e[n+0].position.dot(t)-r>0,i=e[n+1].position.dot(t)-r>0,a=e[n+2].position.dot(t)-r>0,f=(s?1:0)+(i?1:0)+(a?1:0),f){case 0:o.push(e[n]),o.push(e[n+1]),o.push(e[n+2]);break;case 1:if(s&&(l=e[n+1],u=e[n+2],c=d(e[n],l,t,r),p=d(e[n],u,t,r)),i){l=e[n],u=e[n+2],c=d(e[n+1],l,t,r),p=d(e[n+1],u,t,r),o.push(c),o.push(u.clone()),o.push(l.clone()),o.push(u.clone()),o.push(c.clone()),o.push(p);break}a&&(l=e[n],u=e[n+1],c=d(e[n+2],l,t,r),p=d(e[n+2],u,t,r)),o.push(l.clone()),o.push(u.clone()),o.push(c),o.push(p),o.push(c.clone()),o.push(u.clone());break;case 2:s||(l=e[n].clone(),u=d(l,e[n+1],t,r),c=d(l,e[n+2],t,r),o.push(l),o.push(u),o.push(c)),i||(l=e[n+1].clone(),u=d(l,e[n+2],t,r),c=d(l,e[n],t,r),o.push(l),o.push(u),o.push(c)),a||(l=e[n+2].clone(),u=d(l,e[n],t,r),c=d(l,e[n+1],t,r),o.push(l),o.push(u),o.push(c))}}return o}function d(e,t,o,n){const r=e.position.dot(o)-n,s=r/(r-(t.position.dot(o)-n));return new E(new p(e.position.x+s*(t.position.x-e.position.x),e.position.y+s*(t.position.y-e.position.y),e.position.z+s*(t.position.z-e.position.z)),new p(e.normal.x+s*(t.normal.x-e.normal.x),e.normal.y+s*(t.normal.y-e.normal.y),e.normal.z+s*(t.normal.z-e.normal.z)))}u.copy(l).invert(),function(){let t,o=[];const u=new p,f=new p;if(!0===e.geometry.isGeometry)return void console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");const m=e.geometry,d=m.attributes.position,x=m.attributes.normal;if(null!==m.index){const e=m.index;for(t=0;t<e.count;t++)u.fromBufferAttribute(d,e.getX(t)),f.fromBufferAttribute(x,e.getX(t)),c(o,u,f)}else for(t=0;t<d.count;t++)u.fromBufferAttribute(d,t),f.fromBufferAttribute(x,t),c(o,u,f);for(o=h(o,a.set(1,0,0)),o=h(o,a.set(-1,0,0)),o=h(o,a.set(0,1,0)),o=h(o,a.set(0,-1,0)),o=h(o,a.set(0,0,1)),o=h(o,a.set(0,0,-1)),t=0;t<o.length;t++){const e=o[t];i.push(.5+e.position.x/n.x,.5+e.position.y/n.y),e.position.applyMatrix4(l),r.push(e.position.x,e.position.y,e.position.z),s.push(e.normal.x,e.normal.y,e.normal.z)}}(),this.setAttribute("position",new m(r,3)),this.setAttribute("normal",new m(s,3)),this.setAttribute("uv",new m(i,2))}}class E{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}function j(e=[0,0,0]){return function(e){return Array.isArray(e)}(e)?e:e instanceof p||e instanceof x?[e.x,e.y,e.z]:[e,e,e]}const M=h.forwardRef(function({debug:o,mesh:n,children:r,position:s,rotation:i,scale:a,...l},u){const c=h.useRef(null);h.useImperativeHandle(u,()=>c.current);const f=h.useRef(null);return h.useLayoutEffect(()=>{const t=(null==n?void 0:n.current)||c.current.parent,o=c.current;if(!(t instanceof d))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const r={position:new p,rotation:new x,scale:new p(1,1,1)};if(t){e(r,{position:s,scale:a});const n=t.matrixWorld.clone();if(t.matrixWorld.identity(),i&&"number"!=typeof i)e(r,{rotation:i});else{const o=new y;o.position.copy(r.position),o.lookAt(t.position),"number"==typeof i&&o.rotateZ(i),e(r,{rotation:o.rotation})}return o.geometry=new v(t,r.position,r.rotation,r.scale),f.current&&e(f.current,r),t.matrixWorld=n,()=>{o.geometry.dispose()}}},[n,...j(s),...j(a),...j(i)]),h.createElement("mesh",{ref:c},r||h.createElement("meshStandardMaterial",t({transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10},l)),o&&h.createElement("mesh",{ref:f},h.createElement("boxGeometry",null),h.createElement("meshNormalMaterial",{wireframe:!0}),h.createElement("axesHelper",null)))}),R=h.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:s=1,floatIntensity:i=1,floatingRange:a=[-.1,.1],...l},u)=>{const c=h.useRef(null),p=h.useRef(1e4*Math.random());return o(e=>{var o,n;if(!t||0===r)return;const l=p.current+e.clock.getElapsedTime();c.current.rotation.x=Math.cos(l/4*r)/8*s,c.current.rotation.y=Math.sin(l/4*r)/8*s,c.current.rotation.z=Math.sin(l/4*r)/20*s;let u=Math.sin(l/4*r)/10;u=g.mapLinear(u,-.1,.1,null!==(o=null==a?void 0:a[0])&&void 0!==o?o:-.1,null!==(n=null==a?void 0:a[1])&&void 0!==n?n:.1),c.current.position.y=u*i,c.current.updateMatrix()}),h.createElement("group",l,h.createElement("group",{ref:n([c,u]),matrixAutoUpdate:!1},e))}),A=({imgUrl:e,position:t=[0,0,0]})=>{let o=null;const n=h.useMemo(()=>"string"==typeof e&&e.length>0?e:(null==e?void 0:e.src)?e.src:(null==e?void 0:e.default)?e.default:null,[e]);try{n&&(o=u(w,n),o&&(o.colorSpace=b))}catch(s){console.warn(`Failed to load texture: ${n}`,s)}return r.jsxs(R,{speed:1.75,rotationIntensity:1,floatIntensity:2,children:[r.jsx("ambientLight",{intensity:.25}),r.jsx("directionalLight",{position:[0,0,.05]}),r.jsxs("mesh",{position:t,castShadow:!0,receiveShadow:!0,scale:2.75,children:[r.jsx("icosahedronGeometry",{args:[1,1]}),r.jsx("meshStandardMaterial",{color:"#fff8eb",polygonOffset:!0,polygonOffsetFactor:-5,flatShading:!0}),o&&r.jsx(M,{position:[0,0,1],rotation:[0,0,0],scale:1,map:o,flatShading:!0})]})]})},z=({imgUrl:e,position:t=[0,0,0]})=>r.jsx(A,{imgUrl:e,position:t}),L=({icon:e})=>{const t=h.useRef(null),[o,n]=h.useState(!1);return h.useEffect(()=>{const e=t.current;if(!e)return;const o=()=>{n(!0)},r=()=>{n(!1)};return e.addEventListener("webglcontextlost",o),e.addEventListener("webglcontextrestored",r),()=>{var t,n,s;e.removeEventListener("webglcontextlost",o),e.removeEventListener("webglcontextrestored",r);const i=(null==(t=null==e?void 0:e.getContext)?void 0:t.call(e,"webgl2"))||(null==(n=null==e?void 0:e.getContext)?void 0:n.call(e,"webgl"));i&&(null==(s=i.getExtension("WEBGL_lose_context"))||s.loseContext())}},[]),o?r.jsx("div",{className:"w-full h-full bg-gray-700 rounded-full"}):r.jsxs(s,{ref:t,className:"w-full h-full",frameloop:"auto",dpr:[1,1.2],gl:{preserveDrawingBuffer:!1,powerPreference:"high-performance",antialias:!0,alpha:!0,failIfMajorPerformanceCaveat:!0},onCreated:e=>{e.gl.info.autoReset=!0},children:[r.jsxs(h.Suspense,{fallback:r.jsx(i,{}),children:[r.jsx(a,{enableZoom:!1}),r.jsx(z,{imgUrl:e})]}),r.jsx(l,{all:!0})]})};export{z as Ball,L as default};
